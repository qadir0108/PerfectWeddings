@model PerfectWeddings.Models.LoginModel
@{
    Layout = null;
}
<html>
<head>
    <meta charset="utf-8" />
    <title>CALIBER | MATRIX </title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="" name="description" />
    <meta content="" name="author" />
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css" />
    <link href="../assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="../assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
    <link href="../assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css" />
    <link href="../assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN PAGE LEVEL PLUGINS -->
    <link href="../assets/global/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" />
    <link href="../assets/global/plugins/select2/css/select2-bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- END PAGE LEVEL PLUGINS -->
    <!-- BEGIN THEME GLOBAL STYLES -->
    <link href="../assets/global/css/components.min.css" rel="stylesheet" id="style_components" type="text/css" />
    <link href="../assets/global/css/plugins.min.css" rel="stylesheet" type="text/css" />
    <!-- END THEME GLOBAL STYLES -->
    <!-- BEGIN PAGE LEVEL STYLES -->
    <link href="../assets/pages/css/login.min.css" rel="stylesheet" type="text/css" />
    <!-- END PAGE LEVEL STYLES -->
    <!-- BEGIN THEME LAYOUT STYLES -->
    <!-- END THEME LAYOUT STYLES -->
    <link rel="shortcut icon" href="favicon.ico" />
    @Styles.Render("~/bundles/toaster-css")
    <script src="../assets/global/plugins/jquery.min.js" type="text/javascript"></script>
    <link href="~/Content/MySiteCustome.css" rel="stylesheet" />
</head>

<!-- END HEAD -->

<body class="login loginformwidthadjust">
    <!-- BEGIN LOGO -->
    <div class="menu-toggler sidebar-toggler"></div>
    <div id="myLoadingElement" style="display:none">
        <div style="margin:0 auto; padding: 6px; position: fixed; margin-top:50px; ">
            <div align="center"><img src="~/Content/Images/ajax-loader.gif" /></div>
        </div>
    </div>

    <div class="logo">
        <a href="/Home/Index" style="text-decoration:none;">  <h3><span class="Logo1" style="color:white;">CALIBER</span><span class="Logo2" style="color:red;">MATRIX </span></h3></a>
    </div>
    <!-- END LOGO -->

    <div class="content">
        <!-- BEGIN LOGIN FORM -->
        @using (Html.BeginForm())
        {
            @Html.AntiForgeryToken()
            @Html.ValidationSummary(true)
            <input type="hidden" name="error" id="errorCredential" value="@ViewBag.errorCredential" />
            <input type="hidden" name="error" id="loginSuccessfully" value="@ViewBag.loginSuccessfully" />
            <div class="login-form">
                <h3 class="form-title signin-blue">Sign In</h3>
                <div class="alert alert-danger display-hide">
                    <button class="close" data-close="alert"></button>
                    <span> Enter any username and password. </span>
                </div>
                <div class="form-group">
                    <!--ie8, ie9 does not support html5 placeholder, so we just show field title for that-->

                    <label class="control-label visible-ie8 visible-ie9">@Html.LabelFor(it => it.userName)</label>
                    @Html.TextBoxFor(it => it.userName, new { @class = "form-control form-control-solid placeholder-no-fix", @autocomplete = "off", @placeholder = "User Name", @name = "userName", @tabindex = "1" })
                    @Html.ValidationMessageFor(model => model.userName)
                </div>
                <div class="form-group">
                    <label class="control-label visible-ie8 visible-ie9">@Html.LabelFor(it => it.Password)</label>
                    @Html.PasswordFor(it => it.Password, new { @class = "form-control form-control-solid placeholder-no-fix", @autocomplete = "off", @placeholder = "Password", @name = "Password", @tabindex = "2" })
                    @Html.ValidationMessageFor(model => model.Password)
                </div>
                <div class="form-actions">
                    <button type="submit" id="sbtn" class="btn btn-primary uppercase" tabindex="3">Login</button>

                    <label class="rememberme check">
                        <input type="checkbox" name="remember" tabindex="4" value="1" />Remember
                    </label>
                    <a href='@Url.Action("Index", "ForgetLoginPassword")' id="forget-password" tabindex="6" class="forget-password">Forgot Password?</a>
                </div>
                
                <div class="create-account">
                    <p>
                        <a href="/Account/Register" class="uppercase" tabindex="7">Create an account</a>
                    </p>
                </div>
            </div>
        <!-- END LOGIN FORM -->
        }
    </div>
    <!-- BEGIN COPYRIGHT -->
    <div class="copyright"> @DateTime.Now.Year ©Caliber Technologies Inc. </div>

    
    <!--[if lt IE 9]>
     <script src="../assets/global/plugins/respond.min.js"></script>
     <script src="../assets/global/plugins/excanvas.min.js"></script>
     <![endif]-->
    <!-- BEGIN CORE PLUGINS -->
    <script src="../assets/global/plugins/jquery.min.js" type="text/javascript"></script>
    <script src="../assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../assets/global/plugins/js.cookie.min.js" type="text/javascript"></script>
    <script src="../assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
    <script src="../assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
    <script src="../assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
    <script src="../assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
    <script src="../assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>


    <!-- END CORE PLUGINS -->
    <!-- BEGIN PAGE LEVEL PLUGINS -->
    <script src="../assets/global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
    <script src="../assets/global/plugins/jquery-validation/js/additional-methods.min.js" type="text/javascript"></script>
    <script src="../assets/global/plugins/select2/js/select2.full.min.js" type="text/javascript"></script>

    <!-- END PAGE LEVEL PLUGINS -->
    <!-- BEGIN THEME GLOBAL SCRIPTS -->
    <script src="../assets/global/scripts/app.min.js" type="text/javascript"></script>
    <!-- END THEME GLOBAL SCRIPTS -->
    <!-- BEGIN PAGE LEVEL SCRIPTS -->
    <script src="../assets/pages/scripts/login.min.js" type="text/javascript"></script>
    <!-- END PAGE LEVEL SCRIPTS -->
    <!-- BEGIN THEME LAYOUT SCRIPTS -->
    <!-- END THEME LAYOUT SCRIPTS -->
    @Scripts.Render("~/bundles/toaster")
    <script type="text/javascript">
        $('.btn').on('click', function () {
            var $this = $(this);
            $this.button('Wait');
            App.blockUI({
                target: '.content',
                boxed: true,
                message: 'Processing...'
            });
        });
        $(document).ready(function () {
            
            $('.btn').button('reset');
            $("form input").keyup(function (e) {
                //debugger;
                if ((e.which && e.which == 13) || (e.keyCode && e.keyCode == 13)) {
                    if ($(this).attr("id") == "Password") {
                        $('button[type=submit] ').click();
                        return false;
                    }
                    else {
                        var tab = $(this).attr("tabindex");
                        tab++;
                        $("[tabindex='" + tab + "']").focus();
                    }
                } else {
                    return true;
                }
            });

            var errorCredential = document.getElementById("errorCredential").value;
            //debugger;
            if (errorCredential != null && errorCredential != "" && errorCredential == 1) {
                showToaster({ msg: "The entered User name or Password is incorrect", priority: "error", position: "top" });
            }
            else if (errorCredential == 3) {
                showToaster({ msg: "The entered User is not active. Please contact sytem Administrator.", priority: "error", position: "top" });
            }
            else if (errorCredential == 5) {
                showToaster({ msg: "Access Denied. Please contact your administrator.", priority: "error", position: "top" });
            }
            else if (errorCredential == 4) {
                showToaster({ msg: "Unexpected error has occured. Please contact your administrator.", priority: "error", position: "top" });
            }

            else if (errorCredential == 6) {
                showToaster({ msg: "Your License is not valid. Please contact your administrator.", priority: "error", position: "top" });
            }

            $("#register-back-btn").click(function () { lblMessage.innerHTML = ""; lblForgetMessage.innerHTML = ""; clearSingUpFields(); })
            $("#btnForget").click(function () { lblForgetMessage.innerHTML = ""; })
            $("#forget-password").click(function () { lblForgetMessage.innerHTML = ""; })
            $("#register-submit-btn").click(function () { lblMessage.innerHTML = ""; })
            $("#back-btn").click(function () { clearForgetFields(); })

            $("#register_password").focusout(function () {
                if (validatePassword($("#register_password").val()) == false) {
                    lblErrorPassword.innerHTML = "password must contain at least 6 characters and at least 1 number";
                    $("[id$=register_password").css('border', '1px solid Red');
                    $("#register_password").focus();
                }
                else {
                    lblErrorPassword.innerHTML = "";
                    $("[id$=register_password").css('border', '0px');
                }
            });

            $("#txtRPassword").focusout(function () {
                if ($("#register_password").val() != $("#txtRPassword").val()) {
                    lblErrorReTypePassword.innerHTML = "Password not Match";
                    $("[id$=txtRPassword").css('border', '1px solid Red');
                    $("#txtRPassword").focus();
                }
                else {
                    lblErrorReTypePassword.innerHTML = "";
                    $("[id$=txtRPassword").css('border', '0px');
                }

            });
            $("#txtEmail").focusout(function () {
                if (validateEmail($("#txtEmail").val()) == false) {
                    lblErrorEmail.innerHTML = "Email Format is not Valid";
                    $("[id$=txtEmail").css('border', '1px solid Red');
                    $("#txtEmail").focus();
                }
                else {
                    lblErrorEmail.innerHTML = "";
                    $("[id$=txtEmail").css('border', '0px');
                }
            });
        });

        //Sign Up


        //Login
        function LoginMethod() {

            // Charts Value Null
            localStorage.setItem("DefectFuncatoinalPieChart", "");
            localStorage.setItem("DefectTrendFromDate", "");
            localStorage.setItem("DefectTrendToDate", "");
            localStorage.setItem("DefectTrenddlValue", "");
            localStorage.setItem("DefectFuncationrdo", "")

            localStorage.setItem("AutoExecuteChartTestCaseName", "");
            localStorage.setItem("AutoExecuteChartExecutionTime", "");
            localStorage.setItem("AutoTrendFromDate", "");
            localStorage.setItem("AutoTrendToDate", "");
            localStorage.setItem("AutoTrenddlValue", "");

            //
            var userName = document.getElementById('txtLoginUserName').value;
            var password = document.getElementById('txtLoginPassword').value;
            var IsValid = "0";

            if (userName == '') {
                lblErrorLoginUserName.innerHTML = "UserName is Required";
                $("[id$=txtLoginUserName").css('border', '1px solid Red');
                IsValid = "0";
            }
            else {
                lblErrorLoginUserName.innerHTML = "";
                $("[id$=txtLoginUserName").css('border', '0px');
                IsValid = "1";
            }
            if (password == '') {
                lblErrorLoginPassword.innerHTML = "Password is Required";
                $("[id$=txtLoginPassword").css('border', '1px solid Red');
                IsValid = "0";
            }
            else {
                lblErrorLoginPassword.innerHTML = "";
                $("[id$=txtLoginPassword").css('border', '0px');
                IsValid += "2";
            }


            if (IsValid == "12") {
                $('#Loader_Login').show();
                //$("#myLoadingElement").show();
                $.ajax({
                    type: "POST",
                    url: '/Account/SigIn',
                    data: "{UserName : '" + userName + "',Password: '" + password + "'}",
                    contentType: "application/json; charset=utf-8",
                    success: function (response) {
                        var message = response;
                        if (message == "1") {
                            lblLoginMessage.innerHTML = "User Name or Password is not Valid";
                            $("#Message").removeClass("hide");
                            window.setTimeout(function () {
                                App.unblockUI('.content');
                            });
                            return false;
                        }
                        else if (message == "3") {
                            lblLoginMessage.innerHTML = "User is not Acive,Contact to Administrator";
                            $("#Message").removeClass("hide");
                            window.setTimeout(function () {
                                App.unblockUI('.content');
                            });
                            return false;
                        }
                        else if (message == "2") {
                            location.href = " http://localhost:28862/Home/Index";

                        }
                    },

                    failure: function (response) {

                    }
                    ,
                    complete: function () {
                        $('#Loader_Login').hide();

                    }
                });
            }
        }

        // ReadCook
        function readCookie(name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        //ForgetPassword
        function ForgetPassword() {
            var forgotEmail = document.getElementById('txtforgetEmail').value;
            var IsValid = false;

            if (forgotEmail == '') {
                lblErrorForgetEmail.innerHTML = "Email is required";
                $("[id$=txtforgetEmail").css('border', '1px solid Red');
                IsValid = false;
            }
            else if (validateEmail(forgotEmail) == false) {
                lblErrorForgetEmail.innerHTML = "Email Format is not Valid";
                $("[id$=txtforgetEmail").css('border', '1px solid Red');
                IsValid = false;
            }
            else {
                lblErrorForgetEmail.innerHTML = "";
                $("[id$=txtforgetEmail").css('border', '0px');
                IsValid = true;
            }

            if (IsValid == true) {

                $('#Loader_Forget').show();
                $.ajax({
                    type: "POST",
                    url: '/Login.aspx/ForgotPassword',
                    data: "{forgotEmail : '" + forgotEmail + "'}",
                    contentType: "application/json; charset=utf-8",
                    success: function (response) {
                        var message = response.d;

                        if (message == "1") {
                            lblForgetMessage.innerHTML = "No user found with this email address";
                            return false;
                        }
                        else if (message == "2") {
                            lblForgetMessage.innerHTML = "Password has been sent on your email address, please check.";
                        }
                        else {
                            lblForgetMessage.innerHTML = message;
                            return false;
                        }
                        $("[id$=txtforgetEmail").val("");
                    },

                    failure: function (response) {

                    }
                    ,
                    complete: function () {
                        $('#Loader_Forget').hide();

                    }
                });
            }
        }



        function clearSingUpFields() {
            $("#txtUserName").val('');
            $("#register_password").val('');
            $("#txtRPassword").val('');
            $("#txtFirstName").val('');
            $("#txtLastName").val('');
            $("#txtEmail").val('');
            $("#txtCompany").val('');
            $("#txtEmail-error").hide();
            $("#txtRPassword-error").hide();

            lblErrorUserName.innerHTML = "";
            $("[id$=txtUserName").css('border', '0px');
            lblErrorPassword.innerHTML = "";
            $("[id$=register_password").css('border', '0px');
            lblErrorFirstName.innerHTML = "";
            $("[id$=txtFirstName").css('border', '0px');
            lblErrorEmail.innerHTML = "";
            $("[id$=txtEmail").css('border', '0px');
            lblErrorCompany.innerHTML = "";
            $("[id$=txtCompany").css('border', '0px');
            $("#txtRPassword").css('border', '0px');
        }

        function clearForgetFields() {
            $("#txtforgetEmail").val('');
            $("#txtforgetEmail-error").hide();
            lblErrorForgetEmail.innerHTML = "";
            $("[id$=txtforgetEmail").css('border', '0px');
        }


        function validateEmail(email) {
            var re = /\S+@@\S+\.\S+/;
            return re.test(email);

        }

        function validatePassword(password) {
            var pa = /(?!^[0-9]*$)(?!^[a-zA-Z]*$)^([a-zA-Z0-9]{6,20})$/;
            return pa.test(password);
        }
        function GetStatusOfUser() {
            var company = document.getElementById('txtCompany').value;
            $.ajax({
                type: "GET",
                url: '/Account/GetStatusOfUser',
                data: { company: company },
                dataType: "Json",
                success: function (data) {
                    var message = data;

                    if (message == "Owner") {
                        $("#CompanySection").css("display", "block");
                    }
                    else if (message == "Employee") {
                        $("#CompanyAddress").val("Employee");
                        $("#CompanyPhone").val("0545454");
                        $("#CompnayEmail").val("employee@gmail.com");
                    }
                    else {

                        return false;
                    }

                },

                failure: function (response) {
                }
                     ,
                complete: function () {

                }
            });
        }

    </script>
</body>
</html>
